# Tang Nano 6502 CPU 学習教材

Tang Nano FPGA を使用して6502 CPUとLCDコントローラを学ぶための10日間のステップバイステップ教材です。

## 📚 学習の概要

この教材では、FPGAの基礎からSystemVerilog、そして完全な6502 CPU実装まで段階的に学習します。各日は理論と実践のバランスを取り、実際にTang Nano上で動作するプロジェクトを作成していきます。

## 🎯 学習目標

- **FPGA開発**: GoWin EDAツールとTang Nanoの基本操作をマスター
- **SystemVerilog**: ハードウェア記述言語の基本から応用まで習得
- **6502アーキテクチャ**: 古典的なCPUアーキテクチャの理解
- **システム設計**: CPU、メモリ、I/Oの統合設計スキル
- **実践的開発**: 実機での動作確認とデバッグ能力

## 🛠️ 必要なハードウェア

- **Tang Nano 9K** または **Tang Nano 20K** FPGA開発ボード
- **043026-N6(ML) 4.3" 480×272 LCD モジュール** (Day 09以降で使用)
- USB-Cケーブル (プログラミング用)

## 💻 必要なソフトウェア

- **GoWin EDA** (FPGA合成・配置配線ツール)
- **cc65** (6502アセンブラ、Day 10で使用)
- **srecord** (バイナリ変換ツール)
- **Make** (ビルドシステム)

### インストール手順

**macOS:**
```bash
brew install srecord cc65
```

**Linux (Ubuntu/Debian):**
```bash
sudo apt install srecord cc65 golang gtkwave verilator
```

**GoWin EDA:** 公式サイトからダウンロードしてインストール

## 📅 10日間の学習計画

### Day 01: Tang Nano + GoWin EDA 基礎
**学習内容:**
- Tang Nano 9K/20K の基本仕様理解
- GoWin EDA の基本操作とプロジェクト作成
- 最初のHDLプロジェクト: LEDチカチカ (Hello World)
- 制約ファイル (.cst) の基本

**成果物:**
- LEDが点滅するシンプルなプロジェクト
- GoWin EDAでの合成・配置配線・書き込みの基本手順習得

**実習時間:** 約2-3時間

---

### Day 02: SystemVerilog 基礎 (組み合わせ回路)
**学習内容:**
- SystemVerilogの基本構文とモジュール構造
- 組み合わせ回路の設計 (論理ゲート、デコーダ、マルチプレクサ)
- assign文とalways_comb文の使い分け
- テストベンチの基本

**成果物:**
- 7セグメントデコーダ
- 4bit ALU (加算、論理演算)

**実習時間:** 約3-4時間

---

### Day 03: SystemVerilog 基礎 (順序回路)
**学習内容:**
- クロックとリセットの概念
- フリップフロップとラッチ
- always_ff文によるレジスタ設計
- 状態機械 (FSM) の基本
- カウンタとタイマー回路

**成果物:**
- 8bit カウンタ
- LED PWM調光コントローラ
- シンプルな状態機械

**実習時間:** 約3-4時間

---

### Day 04: 6502 CPU アーキテクチャ概論
**学習内容:**
- 6502 CPUの歴史と特徴
- レジスタ構成 (A, X, Y, SP, PC, P)
- メモリマップとアドレッシング
- 命令フェッチ・デコード・実行サイクル
- フラグレジスタとその動作

**成果物:**
- 6502レジスタセットのSystemVerilogモデル
- 簡単な命令デコーダ (一部命令のみ)

**実習時間:** 約2-3時間

---

### Day 05: 6502 命令セットとアドレッシングモード
**学習内容:**
- 6502の13種類のアドレッシングモード詳解
- 主要命令群の分類と動作
- ロード/ストア命令 (LDA, STA, etc.)
- 演算命令 (ADC, SBC, AND, etc.)
- 分岐・ジャンプ命令 (BEQ, JMP, JSR, etc.)

**成果物:**
- アドレッシングモード計算器
- 主要命令のデコードテーブル

**実習時間:** 約3-4時間

---

### Day 06: CPU 実装 Part 1 - デコーダとALU
**学習内容:**
- 命令デコーダの詳細設計
- ALU (Arithmetic Logic Unit) の実装
- フラグ計算ロジック (N, Z, C, V)
- マイクロ命令制御の概念

**成果物:**
- 完全な命令デコーダモジュール
- 6502互換ALUモジュール
- フラグ生成ロジック

**実習時間:** 約4-5時間

---

### Day 07: CPU 実装 Part 2 - メモリインターフェース
**学習内容:**
- メモリバスインターフェース設計
- スタック操作の実装
- ゼロページアクセスの最適化
- メモリマップI/Oの基本

**成果物:**
- メモリコントローラモジュール
- スタックポインタ制御ロジック
- アドレス生成ユニット

**実習時間:** 約4-5時間

---

### Day 08: CPU 実装 Part 3 - 統合とテスト
**学習内容:**
- CPUコアの統合
- 命令サイクル制御
- 基本的な6502プログラムによるテスト
- デバッグ手法とシミュレーション

**成果物:**
- 動作する6502 CPUコア
- 基本命令セットの動作確認
- テストプログラム一式

**実習時間:** 約5-6時間

---

### Day 09: LCD制御とシステム統合
**学習内容:**
- LCD タイミング制御の原理
- RGB信号生成とVGA/LCD出力
- 文字表示システムの設計
- VRAM (Video RAM) の実装
- フォントROMの使用方法

**成果物:**
- LCD コントローラモジュール
- 文字表示機能付きシステム
- 480×272解像度での文字出力

**実習時間:** 約4-5時間

---

### Day 10: アセンブリプログラミングと応用
**学習内容:**
- cc65アセンブラの使用方法
- 6502アセンブリプログラミング実践
- カスタム命令の活用 (CVR, IFO, HLT, WVS)
- システム全体のテストとデバッグ
- 応用プログラムの作成

**成果物:**
- "Hello World" 表示プログラム
- スクロール文字表示
- インタラクティブなデモプログラム

**実習時間:** 約3-4時間

---

## 📁 ディレクトリ構成

```
├── README_ja.md                    # このファイル (メイン教材)
├── day99_completed/                # 最終完成品 (参考用)
│
├── day01/                          # 学習用ディレクトリ
│   ├── README_ja.md               # その日の詳細説明
│   └── (基本テンプレート)
├── day01_completed/               # 完成版一式
│   └── (その日の完全なプロジェクト)
│
├── day02/
├── day02_completed/
│
... (day03 〜 day10 同様)
```

## 🚀 学習の進め方

1. **各日の学習**:
   - `dayXX/README_ja.md` で理論を学習
   - `dayXX/` 内のテンプレートで実践
   - 困った時は `dayXX_completed/` を参考

2. **実機確認**:
   - 各日の成果物は実際にTang Nanoで動作確認
   - シミュレーションと実機での差異を体験

3. **段階的理解**:
   - 前日までの内容を必ず理解してから次へ進む
   - わからない部分は遠慮なく完成版を参照

## 🎓 学習後の到達レベル

この教材を完了すると以下のスキルが身につきます:

- **FPGA開発**: 基本的なFPGAプロジェクトの作成・デバッグができる
- **SystemVerilog**: 中級レベルのHDL設計ができる
- **CPU設計**: シンプルなCPUアーキテクチャを理解し、設計できる
- **システム統合**: CPU、メモリ、I/Oを組み合わせたシステム設計ができる
- **実践的スキル**: 理論だけでなく、実機での動作確認とデバッグができる

## 📖 参考資料

- [6502.org](http://www.6502.org/) - 6502 CPU 公式資料
- [GoWin EDA ドキュメント](https://www.gowinsemi.com/) - FPGA開発ツール
- [SystemVerilog LRM](https://ieeexplore.ieee.org/document/8299595) - 言語仕様書
- `day99_completed/docs/` - 詳細な技術資料

## 🤝 学習サポート

各日のディレクトリには詳細な解説と実習ガイドが含まれています。躓いた場合は:

1. その日の `README_ja.md` を再確認
2. `dayXX_completed/` の完成版を参照
3. `day99_completed/docs/` の技術資料を確認

---

**学習開始準備ができたら `day01/README_ja.md` から始めましょう！**